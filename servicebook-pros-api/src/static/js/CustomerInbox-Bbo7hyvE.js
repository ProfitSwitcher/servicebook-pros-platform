import{j as e,B as v,a as h}from"./dashboard-C0toryoe.js";import{r as a,k as u,c as I,X as Z,l as L,j as g,P as B,o as D,a6 as z,i as H,av as R,b as q}from"./ui-vendor-ClOptf7u.js";import"./chart-vendor-CPMpf-Yy.js";import"./react-vendor-Csw2ODfV.js";const O=({isOpen:x,onClose:C})=>{const[c,b]=a.useState([]),[o,S]=a.useState(null),[f,i]=a.useState([]),[l,y]=a.useState(""),[d,p]=a.useState("sms"),[m,k]=a.useState(""),[F,Y]=a.useState(!1),[A,J]=a.useState([]),[V,j]=a.useState(!1),[K,X]=a.useState(null),w=a.useRef(null),T=[{id:1,customer_id:1,customer_name:"John Meyer",customer_phone:"(406) 799-0536",customer_email:"john.meyer@email.com",last_message:{id:1,content:"Thank you for the quick service today! Everything looks great.",message_type:"sms",direction:"inbound",created_at:"2025-09-12T14:30:00Z",read:!1},unread_count:1,messages:[{id:1,content:"Hi John, your technician Mike will arrive between 2-4 PM today for the HVAC repair.",message_type:"sms",direction:"outbound",created_at:"2025-09-12T10:00:00Z",status:"delivered",read:!0},{id:2,content:"Perfect, I'll be home. Thank you!",message_type:"sms",direction:"inbound",created_at:"2025-09-12T10:05:00Z",read:!0},{id:3,content:"Thank you for the quick service today! Everything looks great.",message_type:"sms",direction:"inbound",created_at:"2025-09-12T14:30:00Z",read:!1}]},{id:2,customer_id:2,customer_name:"Susan Scarr",customer_phone:"(770) 480-9498",customer_email:"susan.scarr@email.com",last_message:{id:4,content:"Your estimate for the plumbing work is ready. Total: $1,250. Please let us know if you'd like to proceed.",message_type:"email",direction:"outbound",created_at:"2025-09-12T11:15:00Z",read:!0},unread_count:0,messages:[{id:4,content:"Your estimate for the plumbing work is ready. Total: $1,250. Please let us know if you'd like to proceed.",message_type:"email",direction:"outbound",subject:"Your Estimate is Ready - ServiceBook Pros",created_at:"2025-09-12T11:15:00Z",status:"delivered",read:!0}]},{id:3,customer_id:3,customer_name:"Michael Pritchard",customer_phone:"(406) 546-9299",customer_email:"michael.pritchard@email.com",last_message:{id:5,content:"Can we reschedule tomorrow's appointment to Friday instead?",message_type:"sms",direction:"inbound",created_at:"2025-09-12T09:45:00Z",read:!1},unread_count:1,messages:[{id:5,content:"Can we reschedule tomorrow's appointment to Friday instead?",message_type:"sms",direction:"inbound",created_at:"2025-09-12T09:45:00Z",read:!1}]}];a.useEffect(()=>{x&&b(T)},[x]),a.useEffect(()=>{M()},[f]);const M=()=>{w.current?.scrollIntoView({behavior:"smooth"})},E=s=>{if(S(s),i(s.messages),j(!1),s.unread_count>0){const t=c.map(r=>r.id===s.id?{...r,unread_count:0,messages:r.messages.map(n=>({...n,read:!0}))}:r);b(t)}},N=async()=>{if(!l.trim()||!o)return;const s={id:Date.now(),content:l,message_type:d,direction:"outbound",created_at:new Date().toISOString(),status:"sending",read:!0};i(t=>[...t,s]),y("");try{setTimeout(()=>{i(t=>t.map(r=>r.id===s.id?{...r,status:"delivered"}:r))},1e3)}catch{i(r=>r.map(n=>n.id===s.id?{...n,status:"failed"}:n))}},P=s=>{switch(s){case"sending":return e.jsx(q,{className:"w-3 h-3 text-gray-400"});case"delivered":return e.jsx(R,{className:"w-3 h-3 text-blue-500"});case"failed":return e.jsx(H,{className:"w-3 h-3 text-red-500"});default:return e.jsx(z,{className:"w-3 h-3 text-gray-400"})}},_=s=>{const t=new Date(s);return(new Date-t)/(1e3*60*60)<24?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString([],{month:"short",day:"numeric"})},$=c.filter(s=>s.customer_name.toLowerCase().includes(m.toLowerCase())||s.customer_phone.includes(m)||s.customer_email.toLowerCase().includes(m.toLowerCase()));return x?e.jsxs("div",{className:"fixed bottom-0 right-4 w-96 h-96 bg-white border border-gray-200 rounded-t-lg shadow-xl z-50 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-blue-600 text-white rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{className:"w-5 h-5"}),e.jsx("h3",{className:"font-semibold",children:"Customer Inbox"}),c.reduce((s,t)=>s+t.unread_count,0)>0&&e.jsx(v,{className:"bg-red-500 text-white",children:c.reduce((s,t)=>s+t.unread_count,0)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>j(!0),className:"text-white hover:bg-blue-700",children:e.jsx(I,{className:"w-4 h-4"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:C,className:"text-white hover:bg-blue-700",children:e.jsx(Z,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"w-1/2 border-r border-gray-200 flex flex-col",children:[e.jsx("div",{className:"p-3 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:m,onChange:s=>k(s.target.value),className:"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:$.map(s=>e.jsxs("div",{onClick:()=>E(s),className:`p-3 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ${o?.id===s.id?"bg-blue-50 border-blue-200":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-900 truncate",children:s.customer_name}),s.unread_count>0&&e.jsx(v,{className:"bg-red-500 text-white text-xs",children:s.unread_count})]}),e.jsxs("div",{className:"flex items-center space-x-1 mb-1",children:[s.last_message.message_type==="sms"?e.jsx(u,{className:"w-3 h-3 text-gray-400"}):e.jsx(g,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.customer_phone})]}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:s.last_message.content}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:_(s.last_message.created_at)})]},s.id))})]}),e.jsx("div",{className:"w-1/2 flex flex-col",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-3 border-b border-gray-200",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-900",children:o.customer_name}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[e.jsx(B,{className:"w-3 h-3"}),e.jsx("span",{children:o.customer_phone})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[e.jsx(g,{className:"w-3 h-3"}),e.jsx("span",{children:o.customer_email})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-3",children:[f.map(s=>e.jsx("div",{className:`flex ${s.direction==="outbound"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] p-2 rounded-lg ${s.direction==="outbound"?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}`,children:[s.subject&&e.jsx("div",{className:"font-medium text-xs mb-1 opacity-75",children:s.subject}),e.jsx("p",{className:"text-xs",children:s.content}),e.jsxs("div",{className:`flex items-center justify-between mt-1 text-xs ${s.direction==="outbound"?"text-blue-100":"text-gray-500"}`,children:[e.jsx("span",{children:_(s.created_at)}),s.direction==="outbound"&&e.jsxs("div",{className:"flex items-center space-x-1",children:[s.message_type==="sms"?e.jsx(u,{className:"w-3 h-3"}):e.jsx(g,{className:"w-3 h-3"}),P(s.status)]})]})]})},s.id)),e.jsx("div",{ref:w})]}),e.jsxs("div",{className:"p-3 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("button",{onClick:()=>p("sms"),className:`px-2 py-1 text-xs rounded ${d==="sms"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600"}`,children:"SMS"}),e.jsx("button",{onClick:()=>p("email"),className:`px-2 py-1 text-xs rounded ${d==="email"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600"}`,children:"Email"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",placeholder:`Type your ${d}...`,value:l,onChange:s=>y(s.target.value),onKeyPress:s=>s.key==="Enter"&&N(),className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(h,{onClick:N,disabled:!l.trim(),size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:e.jsx(D,{className:"w-4 h-4"})})]})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(u,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"Select a conversation to start messaging"})]})})})]})]}):null};export{O as default};
